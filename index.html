<body>
  <!-- Quiz form -->
  <label>Audience:
    <select id="audience">
      <option value="Family">Family</option>
      <option value="Adult">Adult</option>
      <option value="Mixed">Mixed</option>
    </select>
  </label>

  <label>Budget:
    <select id="budget">
      <option value="low">Low</option>
      <option value="mid">Mid</option>
      <option value="high">High</option>
    </select>
  </label>

  <label>Region:
    <select id="region">
      <option value="Caribbean">Caribbean</option>
      <option value="Mediterranean">Mediterranean</option>
      <option value="Europe">Europe</option>
    </select>
  </label>

  <button id="findShips">Find Ships</button>

  <table id="results-table">
    <thead>
      <tr><th>Ship Name</th><th>Score</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Script must be last, just before </body> -->
  <script>
    // Embedding ships directly to avoid fetch issues
    const data = [
      {
        "name": "Carnival Sunshine",
        "scores": {"Family":1,"Luxury":0.2,"Modern":1,"Dining":1,"Size":1},
        "deployment":["Caribbean","Bahamas"]
      },
      {
        "name": "MSC Meraviglia",
        "scores": {"Family":0.8,"Luxury":0.5,"Modern":1,"Dining":1,"Size":1},
        "deployment":["Caribbean","Europe"]
      },
      {
        "name": "Cunard Queen Anne",
        "scores": {"Family":0.5,"Luxury":0.9,"Modern":0,"Dining":1,"Size":0.5},
        "deployment":["Mediterranean","Europe"]
      },
      {
        "name": "Royal Caribbean Odyssey",
        "scores": {"Family":0.9,"Luxury":0.4,"Modern":1,"Dining":1,"Size":1},
        "deployment":["Caribbean","Europe"]
      },
      {
        "name": "Celebrity Constellation",
        "scores": {"Family":0.5,"Luxury":0.7,"Modern":1,"Dining":1,"Size":0.5},
        "deployment":["Caribbean","Mediterranean"]
      }
    ];

    // Convert scores to 60â€“100
    function convertOldScores(ship) {
      const baseline = 60;
      const s = ship.scores;
      const audience = ["Family","Couples","Solo","Friends","Older Adults"];
      let soft = audience.reduce((sum,key)=>sum+(s[key]||0),0)/audience.length*10;
      soft += (s["Luxury"]||0)*6 + (s["Modern"]||0)*6 + (s["Dining"]||0)*6 + (s["Size"]||0)*6;
      const extra = ["Adventure","Cultural","Relaxation","Party","Romantic","Family Fun"];
      soft += extra.reduce((sum,key)=>sum+(s[key]||0),0)/extra.length*6;
      return {...ship, finalScore: Math.min(baseline+soft,100)};
    }

    // Hard exclude logic
    function hardExclude(ship, user){
      if(user.audience==="Family" && (ship.scores.Family||0)<0.3) return true;
      if(user.audience==="Adult" && (ship.scores.Couples||0)<0.3 && (ship.scores["Older Adults"]||0)<0.3) return true;
      if(user.budget==="low" && (ship.scores.Luxury||0)>0.8) return true;
      if(user.budget==="mid" && (ship.scores.Luxury||0)>0.95) return true;
      if(!ship.deployment.includes(user.region)) return true;
      return false;
    }

    function displayResults(ships){
      const tbody = document.querySelector("#results-table tbody");
      tbody.innerHTML = "";
      if(ships.length===0){
        tbody.innerHTML="<tr><td colspan='2'>No ships match your criteria.</td></tr>";
        return;
      }
      ships.forEach(ship=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${ship.name}</td><td>${ship.finalScore.toFixed(0)}</td>`;
        tbody.appendChild(tr);
      });
    }

    function findShips(data,user){
      const results = data.filter(ship=>!hardExclude(ship,user))
                          .map(convertOldScores)
                          .sort((a,b)=>b.finalScore-a.finalScore);
      displayResults(results);
    }

    // Attach button listener
    document.getElementById("findShips").addEventListener("click",()=>{
      console.log("Button clicked!"); // Debug
      const user = {
        audience: document.getElementById("audience").value,
        budget: document.getElementById("budget").value,
        region: document.getElementById("region").value
      };
      console.log("User selection:", user);
      findShips(data,user);
    });
  </script>
</body>
